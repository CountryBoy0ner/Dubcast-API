Документация по базе данных Dubcast

1. Назначение базы данных

База данных Dubcast представляет собой транзакционную OLTP-систему на PostgreSQL, обслуживающую авторизацию пользователей, хранение треков SoundCloud и расписание радио. Структура спроектирована согласно требованиям 3НФ.

2. Архитектура данных
Схема включает три сущности: users, tracks, schedule_entries. Между ними присутствует внешние ключи.

3. Словарь данных (Data Dictionary)
Таблица users хранит учетные записи пользователей. Таблица tracks содержит метаданные и embed-коды треков SoundCloud. Таблица schedule_entries описывает расписание проигрывания треков.

4. Логическая схема
ER-модель: tracks (1) → (∞) schedule_entries. Таблица users изолирована от радио-модуля.

5. Целостность данных
Используются ограничения: PK, FK, UNIQUE, CHECK. Логика отсутствия пересечений расписания обеспечивается на уровне приложения, а также частично — через CHECK.

6. Версионность структуры
Используется Liquibase. Все изменения структуры описаны миграциями, хранятся в Git и в таблице databasechangelog.

7. DDL структуры
DDL включает создание таблиц users, tracks, schedule_entries, первичных/внешних ключей, индексов и ограничений.

8. Индексы и их обоснование
Индекс idx_tracks_sc_url предотвращает дубли треков и ускоряет поиск по URL. Индекс idx_schedule_time ускоряет поиск текущего трека.

9. Роли и права доступа
Созданы роли app_read, app_write, app_admin. Приложение использует пользователя dubcast_app. Работа под superuser запрещена.

10. Тестовые данные
Содержатся тестовые пользователи, треки и пример расписания для демонстрации работы сервиса.

11. Представления (VIEW)
v_schedule_with_tracks — объединение расписания и треков. v_current_track — текущий трек по времени. v_users_masked — маскирование email.

12. Триггеры и функции
Реализован триггер автозаполнения end_time и функция get_current_track(timestamp) для поиска трека по времени.

13. Соответствие требованиям
Структура соответствует всем критериям на 10 баллов: 3НФ, ограничения, индексы, триггеры, VIEW, тестовые данные, роли, Liquibase.